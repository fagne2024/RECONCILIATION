<div class="file-upload-container">
    <!-- Mode de r√©conciliation -->
    <div class="reconciliation-mode-selector">
        <h3>üîÑ Mode de R√©conciliation</h3>
        <div class="mode-options">
            <label class="mode-option">
                <input type="radio" name="reconciliationMode" value="manual" [(ngModel)]="reconciliationMode">
                <span class="mode-label">
                    <i class="fas fa-cogs"></i>
                    <strong>Mode Manuel</strong>
                    <small>Choisissez les fichiers BO et Partenaire s√©par√©ment</small>
                </span>
            </label>
            <label class="mode-option">
                <input type="radio" name="reconciliationMode" value="automatic" [(ngModel)]="reconciliationMode">
                <span class="mode-label">
                    <i class="fas fa-magic"></i>
                    <strong>Mode Automatique</strong>
                    <small>Uploadez un fichier et le syst√®me applique automatiquement le traitement et la r√©conciliation</small>
                </span>
            </label>
            <!-- Mode Super Auto - COMMENT√â
            <button class="mode-option super-auto-mode-btn" (click)="goToReconciliationLauncher()">
                <span class="mode-label">
                    <i class="fas fa-rocket"></i>
                    <strong>Mode Super Auto</strong>
                    <small>R√©conciliation ultra-rapide avec IA avanc√©e et traitement parall√®le</small>
                </span>
            </button>
            -->
        </div>
    </div>

    <!-- Section d'information sur le mode 1-1 -->
    <div class="info-section" *ngIf="reconciliationMode === 'manual'">
        <div class="info-card">
            <div class="info-header">
                <i class="fas fa-info-circle"></i>
                <h4>Mode de R√©conciliation 1-1</h4>
            </div>
            <div class="info-content">
                <p>Le mode 1-1 est le mode de r√©conciliation par d√©faut qui compare chaque transaction BO avec une transaction partenaire correspondante.</p>
                <ul>
                    <li><strong>Correspondance exacte :</strong> Chaque transaction BO doit avoir une transaction partenaire correspondante</li>
                    <li><strong>Crit√®res de matching :</strong> Montant, date, r√©f√©rence, etc.</li>
                    <li><strong>R√©sultat :</strong> Transactions match√©es, non-match√©es et √©carts identifi√©s</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- S√©lecteur de type de r√©conciliation - COMMENT√â (seul le mode 1-1 est conserv√©)
    <div class="reconciliation-mode-selector" *ngIf="reconciliationMode === 'manual' && reconciliationType !== '1-1'">
        <h3>üî¢ Type de R√©conciliation</h3>
        <div class="mode-options">
            <label class="mode-option" [class.selected]="reconciliationType === '1-1'">
                <input type="radio" name="reconciliationType" value="1-1" [(ngModel)]="reconciliationType" (change)="onReconciliationTypeChange('1-1')">
                <span class="mode-label">
                    <i class="fas fa-balance-scale"></i>
                    <strong>1-1</strong>
                    <small>Une transaction BO = Une transaction Partenaire</small>
                </span>
            </label>
            <label class="mode-option" [class.selected]="reconciliationType === '1-2'">
                <input type="radio" name="reconciliationType" value="1-2" [(ngModel)]="reconciliationType" (change)="onReconciliationTypeChange('1-2')">
                <span class="mode-label">
                    <i class="fas fa-layer-group"></i>
                    <strong>1-2</strong>
                    <small>Une transaction BO = Deux transactions Partenaire</small>
                </span>
            </label>
            <label class="mode-option" [class.selected]="reconciliationType === '1-3'">
                <input type="radio" name="reconciliationType" value="1-3" [(ngModel)]="reconciliationType" (change)="onReconciliationTypeChange('1-3')">
                <span class="mode-label">
                    <i class="fas fa-th-large"></i>
                    <strong>1-3</strong>
                    <small>Une transaction BO = Trois transactions Partenaire</small>
                </span>
            </label>
            <label class="mode-option" [class.selected]="reconciliationType === '1-4'">
                <input type="radio" name="reconciliationType" value="1-4" [(ngModel)]="reconciliationType" (change)="onReconciliationTypeChange('1-4')">
                <span class="mode-label">
                    <i class="fas fa-th"></i>
                    <strong>1-4</strong>
                    <small>Une transaction BO = Quatre transactions Partenaire</small>
                </span>
            </label>
            <label class="mode-option" [class.selected]="reconciliationType === '1-5'">
                <input type="radio" name="reconciliationType" value="1-5" [(ngModel)]="reconciliationType" (change)="onReconciliationTypeChange('1-5')">
                <span class="mode-label">
                    <i class="fas fa-th-list"></i>
                    <strong>1-5</strong>
                    <small>Une transaction BO = Cinq transactions Partenaire</small>
                </span>
            </label>
        </div>
    </div>
    -->

    <!-- Indicateur discret du mode 1-1 actif -->
    <div class="reconciliation-mode-indicator" *ngIf="reconciliationMode === 'manual' && reconciliationType === '1-1'">
        <div class="mode-indicator-card">
            <i class="fas fa-balance-scale"></i>
            <span class="mode-text">Mode de r√©conciliation 1-1 actif</span>
            <button class="change-mode-btn" (click)="showReconciliationTypeSelector()">
                <i class="fas fa-cog"></i>
                Changer
            </button>
        </div>
    </div>

    <!-- Indicateur de progression pour gros fichiers -->
    <div class="large-file-progress" *ngIf="isProcessingLargeFile">
        <div class="progress-container">
            <div class="progress-header">
                <h4>üîÑ Traitement en cours...</h4>
                <div class="processing-info">
                    <span class="processing-mode" *ngIf="processingMode">
                        <i class="fas fa-microchip"></i>
                        {{ processingMode }}
                    </span>
                    <button class="cancel-btn" (click)="cancelProcessing()" [disabled]="processingCancelled">
                        <i class="fas fa-times"></i>
                        Annuler
                    </button>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="processingProgress"></div>
            </div>
            <div class="progress-text">{{ processingMessage }}</div>
            <div class="progress-percentage">{{ processingProgress }}%</div>
            <div class="progress-details" *ngIf="processingDetails">
                <div class="detail-item">
                    <span class="detail-label">Mode:</span>
                    <span class="detail-value">{{ processingDetails.mode }}</span>
                </div>
                <div class="detail-item" *ngIf="processingDetails.chunks">
                    <span class="detail-label">Chunks:</span>
                    <span class="detail-value">{{ processingDetails.chunks }}</span>
                </div>
                <div class="detail-item" *ngIf="processingDetails.workers">
                    <span class="detail-label">Workers:</span>
                    <span class="detail-value">{{ processingDetails.workers }}</span>
                </div>
                <div class="detail-item" *ngIf="processingDetails.memory">
                    <span class="detail-label">M√©moire:</span>
                    <span class="detail-value">{{ processingDetails.memory }}</span>
                </div>
            </div>
            <div class="progress-status" *ngIf="processingCancelled">
                <span class="cancelled-status">‚èπÔ∏è Traitement annul√©</span>
            </div>
        </div>
    </div>

    <!-- Mode Manuel -->
    <div class="file-upload-area" *ngIf="reconciliationMode === 'manual'">
        <div class="file-input-container" (click)="boFileInput.click()" [class.has-file]="boFile">
            <div class="file-icon">üè¢</div>
            <h4>BO (Back Office)</h4>
            <p>Cliquez pour s√©lectionner le fichier BO (CSV, XLS, XLSX)</p>
            <input #boFileInput type="file" (change)="onBoFileSelected($event)" accept=".csv, .xls, .xlsx, .xlsm, .xlsb" style="display: none">
            <div class="file-info" [class.loaded]="boFile">
                {{ boFile ? boFile.name : 'Aucun fichier s√©lectionn√©' }}
            </div>
        </div>

        <div class="file-input-container" (click)="partnerFileInput.click()" [class.has-file]="partnerFile">
            <div class="file-icon">ü§ù</div>
            <h4>Partenaire</h4>
            <p>Cliquez pour s√©lectionner le fichier Partenaire (CSV, XLS, XLSX)</p>
            <input #partnerFileInput type="file" (change)="onPartnerFileSelected($event)" accept=".csv, .xls, .xlsx, .xlsm, .xlsb" style="display: none">
            <div class="file-info" [class.loaded]="partnerFile">
                {{ partnerFile ? partnerFile.name : 'Aucun fichier s√©lectionn√©' }}
            </div>
        </div>
    </div>

    <!-- S√©lection des services pour TRXBO en mode manuel -->
    <div class="manual-service-selection-overlay" *ngIf="showManualServiceSelection">
        <div class="manual-service-selection-modal">
            <!-- En-t√™te moderne -->
            <div class="manual-service-selection-header">
                <div class="header-badge">
                    <span class="badge-text">Services disponibles: {{ manualAvailableServices.length }}</span>
                </div>
            </div>
            
            <div class="manual-service-selection-content">
                <!-- Boutons d'action principaux -->
                <div class="manual-service-controls">
                    <button class="modern-btn select-all-btn" (click)="selectAllManualServices()">
                        <i class="fas fa-check-double"></i>
                        Tout s√©lectionner
                    </button>
                    <button class="modern-btn deselect-all-btn" (click)="deselectAllManualServices()">
                        <i class="fas fa-check-double"></i>
                        Tout d√©s√©lectionner
                    </button>
                </div>
                
                <!-- Grille de services en cartes -->
                <div class="manual-service-grid">
                    <div class="manual-service-card" *ngFor="let service of manualAvailableServices">
                        <div class="manual-service-card-content">
                            <div class="manual-service-checkbox-modern">
                                <input type="checkbox" 
                                       [id]="'manual-service-' + service"
                                       [value]="service" 
                                       [checked]="manualSelectedServices.includes(service)"
                                       (change)="onManualServiceSelectionChange($event, service)">
                                <label [for]="'manual-service-' + service" class="checkbox-label">
                                    <span class="checkmark"></span>
                                </label>
                            </div>
                            <div class="manual-service-info">
                                <h4 class="manual-service-name-modern">{{ service }}</h4>
                                <p class="manual-service-count-modern">{{ getManualServiceCount(service) }} lignes</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Boutons de confirmation modernes -->
            <div class="manual-service-selection-actions">
                <button class="modern-btn cancel-btn" (click)="cancelManualServiceSelection()">
                    <i class="fas fa-times"></i>
                    Annuler
                </button>
                <button class="modern-btn confirm-btn" 
                        [disabled]="manualSelectedServices.length === 0"
                        (click)="confirmManualServiceSelection()">
                    <i class="fas fa-check"></i>
                    Confirmer la s√©lection
                </button>
            </div>
        </div>
    </div>

    <!-- Mode Automatique -->
    <div class="auto-reconciliation-area" *ngIf="reconciliationMode === 'automatic'">
        <div class="file-upload-area">
            <div class="file-input-container" (click)="autoBoFileInput.click()" [class.has-file]="autoBoFile || autoBoData.length > 0">
                <div class="file-icon">üè¢</div>
                <h4>BO (Back Office)</h4>
                <p>Cliquez pour s√©lectionner le fichier BO (CSV, XLS, XLSX)</p>
                <input #autoBoFileInput type="file" (change)="onAutoBoFileSelected($event)" accept=".csv, .xls, .xlsx, .xlsm, .xlsb" style="display: none">
                <div class="file-info" [class.loaded]="autoBoFile || autoBoData.length > 0">
                    {{ autoBoFileName || (autoBoFile ? autoBoFile.name : (autoBoData.length > 0 ? 'Fichier charg√© (' + autoBoData.length + ' lignes)' : 'Aucun fichier s√©lectionn√©')) }}
                </div>
            </div>

            <div class="file-input-container" (click)="autoPartnerFileInput.click()" [class.has-file]="autoPartnerFile || autoPartnerData.length > 0">
                <div class="file-icon">ü§ù</div>
                <h4>Partenaire</h4>
                <p>Cliquez pour s√©lectionner le fichier Partenaire (CSV, XLS, XLSX)</p>
                <input #autoPartnerFileInput type="file" (change)="onAutoPartnerFileSelected($event)" accept=".csv, .xls, .xlsx, .xlsm, .xlsb" style="display: none">
                <div class="file-info" [class.loaded]="autoPartnerFile || autoPartnerData.length > 0">
                    {{ autoPartnerFileName || (autoPartnerFile ? autoPartnerFile.name : (autoPartnerData.length > 0 ? 'Fichier charg√© (' + autoPartnerData.length + ' lignes)' : 'Aucun fichier s√©lectionn√©')) }}
                </div>
            </div>
        </div>

        <!-- Status Panel pour le mode automatique -->
        <div class="status-panel" *ngIf="reconciliationMode === 'automatic'">
            <div class="status-item">
                <span class="status-label">BO charg√©:</span>
                <span class="status-value">{{ (autoBoFile || autoBoData.length > 0) ? 'Oui' : 'Non' }}</span>
            </div>
            <div class="status-item" *ngIf="autoBoFile || autoBoData.length > 0">
                <span class="status-label">Fichier BO:</span>
                <span class="status-value">{{ autoBoFileName || (autoBoFile ? autoBoFile.name : 'Fichier charg√©') }}</span>
            </div>
            <div class="status-item" *ngIf="autoBoFile || autoBoData.length > 0">
                <span class="status-label">Nombre de lignes BO:</span>
                <span class="status-value">{{ autoBoData.length }} lignes</span>
            </div>
            <div class="status-item">
                <span class="status-label">Partenaire charg√©:</span>
                <span class="status-value">{{ (autoPartnerFile || autoPartnerData.length > 0) ? 'Oui' : 'Non' }}</span>
            </div>
            <div class="status-item" *ngIf="autoPartnerFile || autoPartnerData.length > 0">
                <span class="status-label">Fichier Partenaire:</span>
                <span class="status-value">{{ autoPartnerFileName || (autoPartnerFile ? autoPartnerFile.name : 'Fichier charg√©') }}</span>
            </div>
            <div class="status-item" *ngIf="autoPartnerFile || autoPartnerData.length > 0">
                <span class="status-label">Nombre de lignes Partenaire:</span>
                <span class="status-value">{{ autoPartnerData.length }} lignes</span>
            </div>
        </div>

        <!-- Messages d'√©tat pour le mode automatique -->
        <div class="messages-section" *ngIf="errorMessage || successMessage">
            <div class="error-message" *ngIf="errorMessage">
                <span class="error-icon">‚ùå</span>
                <div class="error-content">
                    <div class="error-text">{{ errorMessage }}</div>
                    <div class="error-actions" *ngIf="errorMessage.includes('Aucun mod√®le de r√©conciliation trouv√©')">
                        <button class="btn help-btn" (click)="goToModelConfiguration()">
                            <i class="fas fa-cog"></i>
                            Configurer les Mod√®les
                        </button>
                        <button class="btn help-btn" (click)="showModelHelp()">
                            <i class="fas fa-question-circle"></i>
                            Aide
                        </button>
                    </div>
                </div>
                <button class="close-btn" (click)="clearMessages()">√ó</button>
            </div>
            
            <div class="success-message" *ngIf="successMessage">
                <span class="success-icon">‚úÖ</span>
                {{ successMessage }}
                <button class="close-btn" (click)="clearMessages()">√ó</button>
            </div>
        </div>

        <!-- Indicateur de chargement -->
        <div class="loading-section" *ngIf="loading && !showReconciliationProgress">
            <div class="loading-spinner"></div>
            <p>üîÑ Traitement automatique en cours...</p>
            <p class="loading-details">
                Application des mod√®les de traitement et r√©conciliation automatique
            </p>
        </div>

        <!-- Barre de progression de la r√©conciliation automatique -->
        <div class="reconciliation-progress-overlay" *ngIf="showReconciliationProgress">
            <div class="reconciliation-progress-card">
                <div class="reconciliation-progress-header">
                    <h2>{{ reconciliationProgress.percentage === 100 ? '‚úÖ R√©conciliation termin√©e' : 'üîÑ R√©conciliation en cours...' }}</h2>
                    <div class="reconciliation-progress-header-actions">
                        <div class="reconciliation-progress-icon" *ngIf="reconciliationProgress.percentage < 100">
                            <i class="fas fa-cog fa-spin"></i>
                        </div>
                        <div class="reconciliation-progress-icon" *ngIf="reconciliationProgress.percentage === 100">
                            <i class="fas fa-check-circle" style="color: #4CAF50;"></i>
                        </div>
                        <button class="reconciliation-close-btn" (click)="closeReconciliationProgress()" title="Fermer">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <div class="reconciliation-progress-bar-container">
                    <div class="reconciliation-progress-bar">
                        <div class="reconciliation-progress-fill" [style.width.%]="reconciliationProgress.percentage"></div>
                    </div>
                    <div class="reconciliation-progress-text">
                        {{ reconciliationProgress.percentage | number:'1.0-0' }}% termin√©
                    </div>
                </div>
                
                <div class="reconciliation-progress-details">
                    <div class="reconciliation-detail-item">
                        <span class="reconciliation-label">üìã √âtape:</span>
                        <span class="reconciliation-value">{{ reconciliationProgress.step || 'Initialisation...' }}</span>
                    </div>
                    <div class="reconciliation-detail-item" *ngIf="reconciliationProgress.totalBoChunks && reconciliationProgress.totalBoChunks > 0">
                        <span class="reconciliation-label">üì¶ Chunk:</span>
                        <span class="reconciliation-value">
                            {{ reconciliationProgress.currentBoChunk || 0 }}/{{ reconciliationProgress.totalBoChunks }}
                        </span>
                    </div>
                    <div class="reconciliation-detail-item">
                        <span class="reconciliation-label">‚úÖ Matches trouv√©s:</span>
                        <span class="reconciliation-value">{{ (reconciliationProgress.matchesCount || 0) | number }}</span>
                    </div>
                    <div class="reconciliation-detail-item" *ngIf="reconciliationProgress.partnerRemaining !== undefined && reconciliationProgress.partnerRemaining >= 0">
                        <span class="reconciliation-label">üìä Lignes Partner restantes:</span>
                        <span class="reconciliation-value">{{ reconciliationProgress.partnerRemaining | number }}</span>
                    </div>
                    <div class="reconciliation-detail-item">
                        <span class="reconciliation-label">‚ö†Ô∏è √âcarts BO:</span>
                        <span class="reconciliation-value">{{ (reconciliationProgress.boOnlyCount || 0) | number }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Boutons pour le mode automatique -->
        <div class="button-container" *ngIf="reconciliationMode === 'automatic'">
            <button class="btn proceed-btn" [disabled]="!canProceedAuto()" (click)="onAutoProceed()">
                üîÑ Lancer la R√©conciliation Automatique
            </button>
            <div class="action-buttons">
                <button class="btn dashboard-btn" (click)="goToDashboard()">
                    üìà Dashboard
                </button>
                <button class="btn stats-btn" (click)="goToStats()">
                    üìä Statistiques
                </button>
            </div>
        </div>

        <!-- S√©lection des services pour TRXBO - Design Moderne -->
        <div class="service-selection-overlay" *ngIf="showServiceSelection">
            <div class="service-selection-modal">
                <!-- En-t√™te moderne -->
                <div class="service-selection-header">
                    <div class="header-badge">
                        <span class="badge-text">Services disponibles: {{ availableServices.length }}</span>
                    </div>
                </div>
                
                <div class="service-selection-content">
                    <!-- Boutons d'action principaux -->
                    <div class="service-controls">
                        <button class="modern-btn select-all-btn" (click)="selectAllServices()">
                            <i class="fas fa-check-double"></i>
                            Tout s√©lectionner
                        </button>
                        <button class="modern-btn deselect-all-btn" (click)="deselectAllServices()">
                            <i class="fas fa-check-double"></i>
                            Tout d√©s√©lectionner
                        </button>
                    </div>
                    
                    <!-- Grille de services en cartes -->
                    <div class="service-grid">
                        <div class="service-card" *ngFor="let service of availableServices">
                            <div class="service-card-content">
                                <div class="service-checkbox-modern">
                                    <input type="checkbox" 
                                           [id]="'service-' + service"
                                           [value]="service" 
                                           [checked]="selectedServices.includes(service)"
                                           (change)="onServiceSelectionChange($event, service)">
                                    <label [for]="'service-' + service" class="checkbox-label">
                                        <span class="checkmark"></span>
                                    </label>
                                </div>
                                <div class="service-info">
                                    <h4 class="service-name-modern">{{ service }}</h4>
                                    <p class="service-count-modern">{{ getServiceCount(service) }} lignes</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Boutons de confirmation modernes -->
                <div class="service-selection-actions">
                    <button class="modern-btn cancel-btn" (click)="cancelServiceSelection()">
                        <i class="fas fa-times"></i>
                        Annuler
                    </button>
                    <button class="modern-btn confirm-btn" 
                            [disabled]="selectedServices.length === 0"
                            (click)="confirmServiceSelection()">
                        <i class="fas fa-check"></i>
                        Confirmer la s√©lection
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mode Super Auto - COMMENT√â
    <div class="super-auto-reconciliation-area" *ngIf="reconciliationMode === 'super-auto'">
        <div class="file-upload-area">
            <div class="file-input-container" (click)="superAutoBoFileInput.click()" [class.has-file]="superAutoBoFile">
                <div class="file-icon">üè¢</div>
                <h4>BO (Back Office)</h4>
                <p>Cliquez pour s√©lectionner le fichier BO (CSV, XLS, XLSX)</p>
                <input #superAutoBoFileInput type="file" (change)="onSuperAutoBoFileSelected($event)" accept=".csv, .xls, .xlsx, .xlsm, .xlsb" style="display: none">
                <div class="file-info" [class.loaded]="superAutoBoFile">
                    {{ superAutoBoFile ? superAutoBoFile.name : 'Aucun fichier s√©lectionn√©' }}
                </div>
            </div>

            <div class="file-input-container" (click)="superAutoPartnerFileInput.click()" [class.has-file]="superAutoPartnerFile">
                <div class="file-icon">ü§ù</div>
                <h4>Partenaire</h4>
                <p>Cliquez pour s√©lectionner le fichier Partenaire (CSV, XLS, XLSX)</p>
                <input #superAutoPartnerFileInput type="file" (change)="onSuperAutoPartnerFileSelected($event)" accept=".csv, .xls, .xlsx, .xlsm, .xlsb" style="display: none">
                <div class="file-info" [class.loaded]="superAutoPartnerFile">
                    {{ superAutoPartnerFile ? superAutoPartnerFile.name : 'Aucun fichier s√©lectionn√©' }}
                </div>
            </div>
        </div>

        <div class="status-panel" *ngIf="reconciliationMode === 'super-auto'">
            <div class="status-item">
                <span class="status-label">BO charg√©:</span>
                <span class="status-value">{{ superAutoBoFile ? 'Oui' : 'Non' }}</span>
            </div>
            <div class="status-item" *ngIf="superAutoBoFile">
                <span class="status-label">Nombre de lignes BO:</span>
                <span class="status-value">{{ superAutoBoData.length }} lignes</span>
            </div>
            <div class="status-item">
                <span class="status-label">Partenaire charg√©:</span>
                <span class="status-value">{{ superAutoPartnerFile ? 'Oui' : 'Non' }}</span>
            </div>
            <div class="status-item" *ngIf="superAutoPartnerFile">
                <span class="status-label">Nombre de lignes Partenaire:</span>
                <span class="status-value">{{ superAutoPartnerData.length }} lignes</span>
            </div>
            <div class="status-item" *ngIf="superAutoEstimatedTime">
                <span class="status-label">Temps estim√© (Super Auto):</span>
                <span class="status-value">{{ superAutoEstimatedTime }}</span>
            </div>
        </div>

        <div class="button-container" *ngIf="reconciliationMode === 'super-auto'">
            <button class="btn proceed-btn super-auto-btn" [disabled]="!canProceedSuperAuto()" (click)="onSuperAutoProceed()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 10px; font-weight: bold;">
                üöÄ Lancer la R√©conciliation Super Auto
            </button>
            <div class="action-buttons">
                <button class="btn dashboard-btn" (click)="goToDashboard()">
                    üìà Dashboard
                </button>
                <button class="btn stats-btn" (click)="goToStats()">
                    üìä Statistiques
                </button>
            </div>
        </div>
    </div>
    -->

    <!-- Status Panel pour le mode manuel -->
    <div class="status-panel" *ngIf="reconciliationMode === 'manual'">
        <div class="status-item">
            <span class="status-label">BO charg√©:</span>
            <span class="status-value">{{ boFile ? 'Oui' : 'Non' }}</span>
        </div>
        <div class="status-item" *ngIf="boFile">
            <span class="status-label">Nombre de lignes BO:</span>
            <span class="status-value">{{ boData.length }} lignes</span>
        </div>
        <div class="status-item">
            <span class="status-label">Partenaire charg√©:</span>
            <span class="status-value">{{ partnerFile ? 'Oui' : 'Non' }}</span>
        </div>
        <div class="status-item" *ngIf="partnerFile">
            <span class="status-label">Nombre de lignes Partenaire:</span>
            <span class="status-value">{{ partnerData.length }} lignes</span>
        </div>
        <div class="status-item" *ngIf="estimatedTime">
            <span class="status-label">Temps estim√©:</span>
            <span class="status-value">{{ estimatedTime }}</span>
        </div>
    </div>

    <!-- Affichage des colonnes pour le mode manuel -->
    <div class="columns-display" *ngIf="reconciliationMode === 'manual' && (boData.length > 0 || partnerData.length > 0)">
        <div class="columns-section">
            <h3>üìä Colonnes d√©tect√©es</h3>
            
            <!-- Colonnes BO -->
            <div class="file-columns" *ngIf="boData.length > 0">
                <h4>üìÅ Fichier BO ({{ boData.length }} lignes)</h4>
                <div class="columns-list">
                    <span class="column-tag" *ngFor="let column of getColumnsFromData(boData)">{{ column }}</span>
                </div>
            </div>
            
            <!-- Colonnes Partenaire -->
            <div class="file-columns" *ngIf="partnerData.length > 0">
                <h4>üìÅ Fichier Partenaire ({{ partnerData.length }} lignes)</h4>
                <div class="columns-list">
                    <span class="column-tag" *ngFor="let column of getColumnsFromData(partnerData)">{{ column }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Boutons pour le mode manuel -->
    <div class="button-container" *ngIf="reconciliationMode === 'manual'">
        <div class="debug-info" style="background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; font-size: 12px;">
            <strong>Debug:</strong> BO: {{ boData.length }} lignes | Partenaire: {{ partnerData.length }} lignes | Bouton actif: {{ canProceed() ? 'Oui' : 'Non' }}
        </div>
        
        <!-- Message d'information si fichier partenaire manquant -->
        <div *ngIf="boData.length > 0 && partnerData.length === 0" class="info-message" style="background: #e3f2fd; border: 1px solid #2196f3; padding: 15px; margin: 10px 0; border-radius: 5px; color: #1976d2;">
            <i class="fas fa-info-circle"></i>
            <strong>Information:</strong> Le fichier BO est charg√© ({{ boData.length }} lignes). Veuillez maintenant uploader le fichier partenaire pour continuer.
        </div>
        
        <!-- Message d'information pour gros fichiers -->
        <div *ngIf="isLargeFileDetected()" class="large-file-info" style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; margin: 10px 0; border-radius: 5px; color: #856404;">
            <i class="fas fa-exclamation-triangle"></i>
            <strong>Gros fichier d√©tect√©:</strong> Le syst√®me utilisera un traitement par chunks optimis√© pour √©viter les erreurs de m√©moire. Le traitement peut prendre plus de temps mais sera plus stable.
        </div>
        
        <button class="btn proceed-btn" [disabled]="!canProceed()" (click)="onProceed()" style="background-color: #4CAF50; color: white; padding: 15px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 10px;">
            üöÄ Lancer la R√©conciliation Manuelle
        </button>
        <div class="action-buttons">
            <button class="btn dashboard-btn" (click)="goToDashboard()">
                üìà Dashboard
            </button>
            <button class="btn stats-btn" (click)="goToStats()">
                üìä Statistiques
            </button>
        </div>
    </div>
</div>

<div class="file-watcher-container">
  <!-- Message d'erreur -->
  <div *ngIf="errorMessage" class="error-message">
    <span>{{ errorMessage }}</span>
    <button (click)="clearError()" class="btn-close-error">√ó</button>
  </div>

  <!-- Indicateur de chargement -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="loading-spinner">Chargement...</div>
  </div>

  <div class="header">
    <h2>üîÑ Syst√®me de Surveillance de Fichiers</h2>
    <p>Surveillez automatiquement un dossier et traitez les fichiers selon vos sp√©cifications</p>
  </div>

  <!-- Statut de la surveillance -->
  <div class="status-card" [class.active]="status?.isProcessing">
    <div class="status-header">
      <h3>Statut de la Surveillance</h3>
      <div class="status-indicator" [class.running]="status?.isProcessing">
        {{ status?.isProcessing ? 'üü¢ Actif' : 'üî¥ Inactif' }}
      </div>
    </div>
    
    <div class="status-details">
      <p><strong>Dossier surveill√©:</strong> {{ status?.watchPath || 'Non configur√©' }}</p>
      <p><strong>Fichiers en attente:</strong> {{ status?.queueLength || 0 }}</p>
    </div>

    <div class="status-actions">
      <button 
        class="btn btn-primary" 
        (click)="startWatching()"
        [disabled]="status?.isProcessing || loading">
        D√©marrer la surveillance
      </button>
      <button 
        class="btn btn-secondary" 
        (click)="stopWatching()"
        [disabled]="!status?.isProcessing || loading">
        Arr√™ter la surveillance
      </button>
    </div>
  </div>

  <!-- Gestion des sp√©cifications -->
  <div class="specifications-section">
    <div class="section-header">
      <h3>üìã Sp√©cifications de Traitement</h3>
      <button class="btn btn-success" (click)="showCreateForm = true">
        + Nouvelle Sp√©cification
      </button>
    </div>

    <!-- Liste des sp√©cifications -->
    <div class="specifications-list">
      <div 
        *ngFor="let spec of specifications" 
        class="specification-card"
        [class.active]="spec.autoProcess">
        <div class="spec-header">
          <h4>{{ spec.name }}</h4>
          <div class="spec-status">
            <span class="badge" [class.active]="spec.autoProcess">
              {{ spec.autoProcess ? 'Auto' : 'Manuel' }}
            </span>
          </div>
        </div>
        
        <div class="spec-details">
          <p><strong>Pattern:</strong> {{ spec.filePattern }}</p>
          <p><strong>Type:</strong> {{ spec.processingType.toUpperCase() }}</p>
          <p><strong>Sortie:</strong> {{ spec.outputFormat || 'JSON' }}</p>
        </div>

        <div class="spec-actions">
          <button class="btn btn-sm btn-primary" (click)="editSpecification(spec)">
            ‚úèÔ∏è Modifier
          </button>
          <button class="btn btn-sm btn-danger" (click)="deleteSpecification(spec.id)">
            üóëÔ∏è Supprimer
          </button>
        </div>
      </div>

      <div *ngIf="specifications.length === 0" class="empty-state">
        <p>Aucune sp√©cification configur√©e</p>
        <button class="btn btn-primary" (click)="showCreateForm = true">
          Cr√©er votre premi√®re sp√©cification
        </button>
      </div>
    </div>
  </div>

  <!-- Formulaire de cr√©ation/√©dition -->
  <div *ngIf="showCreateForm || editingSpec" class="form-overlay">
    <div class="form-modal">
      <div class="form-header">
        <h3>{{ editingSpec ? 'Modifier' : 'Cr√©er' }} une Sp√©cification</h3>
        <button class="btn-close" (click)="closeForm()">√ó</button>
      </div>

      <form [formGroup]="specificationForm" (ngSubmit)="saveSpecification()">
        <div class="form-row">
          <div class="form-group">
            <label for="name">Nom de la sp√©cification *</label>
            <input 
              id="name" 
              type="text" 
              formControlName="name" 
              placeholder="Ex: Fichiers CSV clients">
          </div>
          
          <div class="form-group">
            <label for="filePattern">Pattern de fichiers *</label>
            <input 
              id="filePattern" 
              type="text" 
              formControlName="filePattern" 
              placeholder="Ex: *.csv ou clients_*.csv">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="processingType">Type de traitement *</label>
            <select id="processingType" formControlName="processingType">
              <option value="csv">CSV</option>
              <option value="json">JSON</option>
              <option value="xml">XML</option>
              <option value="excel">Excel</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="outputFormat">Format de sortie</label>
            <select id="outputFormat" formControlName="outputFormat">
              <option value="json">JSON</option>
              <option value="csv">CSV</option>
              <option value="database">Base de donn√©es</option>
            </select>
          </div>
        </div>

        <div class="form-row" *ngIf="specificationForm.get('processingType')?.value === 'csv'">
          <div class="form-group">
            <label for="delimiter">D√©limiteur</label>
            <input 
              id="delimiter" 
              type="text" 
              formControlName="delimiter" 
              placeholder="Ex: ; ou ,">
          </div>
          
          <div class="form-group">
            <label for="encoding">Encodage</label>
            <input 
              id="encoding" 
              type="text" 
              formControlName="encoding" 
              placeholder="Ex: utf8">
          </div>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="autoProcess">
            Traitement automatique
          </label>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="closeForm()">
            Annuler
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="specificationForm.invalid || loading">
            {{ editingSpec ? 'Modifier' : 'Cr√©er' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Exemples de sp√©cifications -->
  <div class="examples-section">
    <h3>üí° Exemples de Sp√©cifications</h3>
    <div class="examples-grid">
      <div *ngFor="let example of examples" class="example-card">
        <h4>{{ example.name }}</h4>
        <p><strong>Pattern:</strong> {{ example.filePattern }}</p>
        <p><strong>Type:</strong> {{ example.processingType }}</p>
        <button class="btn btn-sm btn-outline" (click)="loadExample(example)">
          Utiliser cet exemple
        </button>
      </div>
    </div>
  </div>
</div> 
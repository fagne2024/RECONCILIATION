<div class="traitement-container">
  <div class="header-section">
    <h2>Traitement de fichiers (CSV, XLS, XLSX)</h2>
    <div class="header-actions">
      <button type="button" class="btn btn-outline-secondary" (click)="toggleAllSections()">
        <i class="fas fa-eye" *ngIf="!allSectionsVisible"></i>
        <i class="fas fa-eye-slash" *ngIf="allSectionsVisible"></i>
        {{ allSectionsVisible ? 'Masquer tout' : 'Afficher tout' }}
      </button>
      <button type="button" class="new-treatment-btn" (click)="newTraitement()">+ Nouveau traitement</button>
    </div>
  </div>
  
  <!-- Barre de progression pour les fichiers volumineux -->
  <div *ngIf="dataProcessingService.isProcessing$ | async" class="processing-overlay">
    <div class="processing-container">
      <div class="processing-header">
        <div class="processing-icon">üîÑ</div>
        <h3>Traitement en cours...</h3>
        <p>{{ dataProcessingService.processingMessage$ | async }}</p>
      </div>
      <div class="progress-bar-container">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="(dataProcessingService.processingProgress$ | async)?.percentage || 0"></div>
        </div>
        <div class="progress-text">{{ (dataProcessingService.processingProgress$ | async)?.percentage?.toFixed(1) || 0 }}%</div>
      </div>
      <div class="processing-info">
        <p>{{ (dataProcessingService.processingProgress$ | async)?.message || 'Traitement en cours...' }}</p>
        <p class="processing-tip">Veuillez patienter, le traitement peut prendre quelques minutes pour les fichiers volumineux...</p>
      </div>
    </div>
  </div>
  
  <div class="upload-area" (drop)="onDrop($event)" (dragover)="onDragOver($event)">
    <p>Glissez-d√©posez vos fichiers (CSV, XLS, XLSX) ici ou</p>
    <input type="file" multiple accept=".csv,.xls,.xlsx,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" (change)="onFileSelected($event)" id="fileInput" hidden />
    <button type="button" (click)="triggerFileInput()" [disabled]="isProcessing">S√©lectionner des fichiers (CSV, XLS, XLSX)</button>
    <div class="upload-info">
      <p><small>üí° Optimis√© pour fichiers jusqu'√† 1M lignes (2GB max)</small></p>
      <p><small>‚ö° Traitement par chunks pour performance maximale</small></p>
    </div>
    <div *ngIf="errorMsg.upload" class="error-msg">{{ errorMsg.upload }}</div>
  </div>
  <div *ngIf="successMsg.upload" class="success-msg" [innerHTML]="successMsg.upload"></div>
  
  <!-- Affichage des erreurs du service -->
  <div *ngIf="dataProcessingService.error$ | async as error" class="error-msg">
    <strong>Erreur de traitement:</strong> {{ error?.message }}
    <span *ngIf="error?.file"> ({{ error?.file }})</span>
  </div>
  
  <!-- Pr√©visualisation CSV -->
  <div *ngIf="showCsvPreview && csvPreviewData.length > 0" class="csv-preview-section">
    <h4>üìã Pr√©visualisation du fichier CSV</h4>
    <div class="preview-info">
      <p><strong>S√©parateur d√©tect√© :</strong> <code>{{ detectedDelimiter }}</code></p>
      <p><strong>Colonnes :</strong> {{ csvPreviewColumns.length }}</p>
      <p><strong>Aper√ßu :</strong> {{ csvPreviewData.length }} lignes</p>
    </div>
    
    <div class="csv-preview-table">
      <table>
        <thead>
          <tr>
            <th *ngFor="let col of csvPreviewColumns">{{ col }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of csvPreviewData">
            <td *ngFor="let col of csvPreviewColumns">{{ row[col] || '' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class="preview-actions">
      <button type="button" (click)="confirmCsvImport()" class="confirm-btn">
        ‚úÖ Confirmer l'import
      </button>
      <button type="button" (click)="cancelCsvPreview()" class="cancel-btn">
        ‚ùå Annuler
      </button>
    </div>
  </div>
  
  <div *ngIf="selectedFiles.length > 0" class="file-list">
    <h4>Fichiers s√©lectionn√©s :</h4>
    <ul>
      <li *ngFor="let file of selectedFiles">{{ file.name }}</li>
    </ul>
  </div>
  
     <!-- Indication Orange Money -->
   <div *ngIf="isOrangeMoneyFile" class="orange-money-indicator">
     <div class="orange-money-badge">
       <i class="fas fa-mobile-alt"></i>
       <span>Fichier Orange Money d√©tect√©</span>
       <small>Les lignes au-dessus de la premi√®re colonne "N¬∞" seront ignor√©es</small>
     </div>
           <div class="orange-money-features">
        <div class="feature-item">
          <i class="fas fa-filter"></i>
          <span>Filtre automatique "Succ√®s" appliqu√©</span>
        </div>
        <div class="feature-item">
          <i class="fas fa-exchange-alt"></i>
          <span>Filtre automatique "Cash in" et "Merchant Payment" appliqu√©</span>
        </div>
        <div class="feature-item">
          <i class="fas fa-columns"></i>
          <span>Affichage automatique des colonnes : R√©f√©rence, D√©bit, Cr√©dit, N¬∞ de Compte, DATE, Service, Statut</span>
        </div>
        <div class="feature-item">
          <i class="fas fa-calendar-alt"></i>
          <span>Concat√©nation automatique Date + Heure ‚Üí colonne "DATE"</span>
        </div>
      </div>
   </div>
  
  <!-- Aper√ßu des donn√©es combin√©es en premi√®re position -->
  <div *ngIf="combinedRows.length > 0" class="preview-table" style="margin-top: 32px;">
    <div class="section-header">
      <h4>
        <i class="fas fa-table"></i> Aper√ßu des donn√©es combin√©es
        <button type="button" class="btn btn-sm btn-outline-info" (click)="toggleSection('preview')">
          <i class="fas fa-eye" *ngIf="!showSections.preview"></i>
          <i class="fas fa-eye-slash" *ngIf="showSections.preview"></i>
          {{ showSections.preview ? 'Masquer' : 'Afficher' }}
        </button>
      </h4>
    </div>
    
    <div *ngIf="showSections.preview" class="section-content">
   
   <!-- Contr√¥les de r√©organisation des colonnes -->
   <div class="column-reorder-controls" style="margin-bottom: 16px;">
     <div class="reorder-controls">
       <button type="button" 
               (click)="toggleColumnReorderMode()" 
               [class.active]="isColumnReorderMode"
               class="reorder-btn">
         {{ isColumnReorderMode ? 'üîÑ Mode r√©organisation actif' : 'üìã R√©organiser les colonnes' }}
       </button>
       
       <div *ngIf="isColumnReorderMode" class="reorder-actions">
         <button type="button" (click)="applyColumnReorder()" class="apply-btn">‚úÖ Appliquer</button>
         <button type="button" (click)="cancelColumnReorder()" class="cancel-btn">‚ùå Annuler</button>
       </div>
     </div>
     
     <div *ngIf="isColumnReorderMode" class="reorder-instructions">
       <span class="instruction-text">üí° Glissez-d√©posez les colonnes pour les r√©organiser ou utilisez les boutons ‚Üë‚Üì</span>
     </div>
   </div>
   
   <!-- Informations sur le fichier -->
   <div class="file-info-panel" *ngIf="combinedRows.length > 1000">
     <div class="file-stats">
       <div class="stat-item">
         <span class="stat-label">üìä Total lignes :</span>
         <span class="stat-value">{{ combinedRows.length.toLocaleString() }}</span>
       </div>
       <div class="stat-item">
         <span class="stat-label">üìã Colonnes :</span>
         <span class="stat-value">{{ columns.length }}</span>
       </div>
       <div class="stat-item">
         <span class="stat-label">üíæ Taille estim√©e :</span>
         <span class="stat-value">{{ getFileStats().fileSize }}</span>
       </div>
     </div>
     <div class="performance-tips" *ngIf="getFileStats().isLargeFile">
       <div class="tip-icon">üí°</div>
       <div class="tip-content">
         <strong>Conseils pour les gros fichiers :</strong>
         <ul>
           <li>Utilisez les filtres pour r√©duire la quantit√© de donn√©es affich√©es</li>
           <li>S√©lectionnez uniquement les colonnes n√©cessaires</li>
           <li>Utilisez la pagination pour naviguer efficacement</li>
           <li>√âvitez d'afficher toutes les lignes pour de meilleures performances</li>
         </ul>
       </div>
     </div>
   </div>
   <!-- Contr√¥les d'affichage -->
   <div class="display-controls" *ngIf="combinedRows.length > 20">
     <div class="control-group">
       <label>Lignes par page :</label>
       <select [(ngModel)]="rowsPerPage" (change)="onRowsPerPageChange()" [disabled]="showAllRows">
         <option value="50">50</option>
         <option value="100">100</option>
         <option value="200">200</option>
         <option value="500">500</option>
         <option value="1000">1000</option>
       </select>
     </div>
     <div class="control-group">
       <label>
         <input type="checkbox" [(ngModel)]="showAllRows" (change)="toggleShowAllRows()">
         Afficher toutes les lignes ({{ combinedRows.length }})
       </label>
     </div>
     <div class="control-group" *ngIf="!showAllRows">
       <span class="info-text">
         Affichage des lignes {{ startRow }} √† {{ endRow }} sur {{ combinedRows.length }} total
       </span>
     </div>
   </div>
   <div class="table-responsive">
     <div class="export-csv-bar" style="margin-bottom: 8px; display: flex; align-items: center; gap: 16px;">
       <div class="export-controls" style="display: flex; align-items: center; gap: 8px;">
         <label for="exportFileName" style="font-weight: 500; color: #333;">Nom du fichier:</label>
         <input 
           type="text" 
           id="exportFileName"
           [(ngModel)]="exportFileName" 
           placeholder="resultat"
           [disabled]="isExporting"
           style="padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; min-width: 150px;"
           title="Entrez le nom du fichier (l'extension sera ajout√©e automatiquement selon le format choisi)">
       </div>
       <button type="button" 
               (click)="exportCSV()" 
               [disabled]="isExporting"
               style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; opacity: isExporting ? 0.6 : 1;">
         {{ isExporting ? 'Export en cours...' : 'Exporter en CSV' }}
       </button>
       <button type="button" 
               (click)="exportXLS()" 
               [disabled]="isExporting"
               style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; opacity: isExporting ? 0.6 : 1; margin-right: 8px;">
         {{ isExporting ? 'Export en cours...' : 'Exporter en XLS' }}
       </button>
       <button type="button" 
               (click)="exportXLSX()" 
               [disabled]="isExporting"
               style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; opacity: isExporting ? 0.6 : 1;">
         {{ isExporting ? 'Export en cours...' : 'Exporter en XLSX' }}
       </button>
       
       <!-- Barre de progression pour l'export -->
       <div *ngIf="isExporting" class="export-progress" style="flex: 1; margin-left: 16px;">
         <div style="display: flex; align-items: center; gap: 8px;">
           <div style="flex: 1; background: #f0f0f0; border-radius: 4px; height: 8px; overflow: hidden;">
             <div [style.width.%]="exportProgress.percentage" 
                  style="background: linear-gradient(90deg, #007bff, #28a745); height: 100%; transition: width 0.3s ease;"></div>
           </div>
           <span style="font-size: 12px; color: #666; min-width: 60px;">{{ exportProgress.percentage | number:'1.0-0' }}%</span>
         </div>
         <div style="font-size: 12px; color: #666; margin-top: 4px;">{{ exportProgress.message }}</div>
       </div>
       
       <div *ngIf="successMsg.export" class="success-msg">{{ successMsg.export }}</div>
       <div *ngIf="errorMsg.export" class="error-msg">{{ errorMsg.export }}</div>
       <div *ngIf="successMsg.reorder" class="success-msg">{{ successMsg.reorder }}</div>
     </div>
     <table>
       <thead>
         <tr>
           <th *ngFor="let col of getDisplayColumns(); let i = index"
               [draggable]="isColumnReorderMode"
               (dragstart)="onColumnDragStart($event, col)"
               (dragover)="onColumnDragOver($event, col)"
               (drop)="onColumnDrop($event, col)"
               (dragend)="onColumnDragEnd()"
               [class.dragging]="isColumnDragging(col)"
               [class.drag-over]="isColumnDragOver(col)"
               [class.reorder-mode]="isColumnReorderMode"
               class="column-header">
             
             <div class="column-content">
               <span class="column-title">{{ col }}</span>
               
               <div *ngIf="isColumnReorderMode" class="column-controls">
                 <button type="button" 
                         (click)="moveColumnUp(col)" 
                         [disabled]="i === 0"
                         class="move-btn move-up"
                         title="D√©placer vers le haut">
                   ‚Üë
                 </button>
                 <button type="button" 
                         (click)="moveColumnDown(col)" 
                         [disabled]="i === getDisplayColumns().length - 1"
                         class="move-btn move-down"
                         title="D√©placer vers le bas">
                   ‚Üì
                 </button>
               </div>
             </div>
           </th>
         </tr>
       </thead>
       <tbody>
         <tr *ngFor="let row of displayedRows">
           <td *ngFor="let col of getDisplayColumns()">{{ row[col] }}</td>
         </tr>
       </tbody>
     </table>
     <!-- Pagination -->
     <div class="pagination" *ngIf="!showAllRows && totalPages > 1">
       <div class="pagination-info">
         Page {{ currentPage }} sur {{ totalPages }}
       </div>
       <div class="pagination-controls">
         <button 
           type="button" 
           (click)="onPageChange(1)" 
           [disabled]="currentPage === 1"
           class="pagination-btn">
           ¬´ Premi√®re
         </button>
         <button 
           type="button" 
           (click)="onPageChange(currentPage - 1)" 
           [disabled]="currentPage === 1"
           class="pagination-btn">
           ‚Äπ Pr√©c√©dente
         </button>
         <span class="page-numbers">
           <ng-container *ngFor="let page of getPageNumbers()">
             <span *ngIf="page === -1" class="page-ellipsis">...</span>
             <button 
               *ngIf="page !== -1"
               type="button" 
               (click)="onPageChange(page)" 
               [class.active]="page === currentPage"
               class="pagination-btn page-number">
               {{ page }}
             </button>
           </ng-container>
         </span>
         <button 
           type="button" 
           (click)="onPageChange(currentPage + 1)" 
           [disabled]="currentPage === totalPages"
           class="pagination-btn">
           Suivante ‚Ä∫
         </button>
         <button 
           type="button" 
           (click)="onPageChange(totalPages)" 
           [disabled]="currentPage === totalPages"
           class="pagination-btn">Derni√®re ¬ª</button>
       </div>
     </div>
     <!-- Message d'information pour les gros fichiers -->
     <div *ngIf="combinedRows.length > 10000" class="large-file-info">
       <div class="info-box">
         <strong>Fichier volumineux d√©tect√© :</strong> {{ combinedRows.length.toLocaleString() }} lignes
         <br>
         <small>
           üí° Conseil : Utilisez les filtres ou la s√©lection de colonnes pour r√©duire la taille des donn√©es affich√©es.
         </small>
       </div>
     </div>
   </div>
   </div>
  
  <div *ngIf="allColumns.length > 0" class="select-cols-section">
    <div class="section-header">
      <h4>
        <i class="fas fa-columns"></i> S√©lection des colonnes √† conserver
        <button type="button" class="btn btn-sm btn-outline-info" (click)="toggleSection('selectCols')">
          <i class="fas fa-eye" *ngIf="!showSections.selectCols"></i>
          <i class="fas fa-eye-slash" *ngIf="showSections.selectCols"></i>
          {{ showSections.selectCols ? 'Masquer' : 'Afficher' }}
        </button>
      </h4>
    </div>
    
    <div *ngIf="showSections.selectCols" class="section-content">
    <div class="select-cols">
      <label>
        <input type="checkbox"
               [checked]="selectedCols.length === allColumns.length && allColumns.length > 0"
               (change)="toggleSelectAllCols($event)">
        Tous
      </label>
      <!-- Colonnes individuelles -->
      <label *ngFor="let col of allColumns">
        <input type="checkbox" [value]="col" [checked]="selectedCols.includes(col)" (change)="onSelectColChange($event)">
        {{ col }}
      </label>
    </div>
    <div class="select-cols-actions">
      <button type="button" class="select-cols-btn apply-btn" (click)="applyColumnSelection()" [disabled]="selectedCols.length === 0">Appliquer la s√©lection</button>
      <button type="button" class="select-cols-btn reset-btn" (click)="resetColumnSelection()">R√©initialiser la s√©lection</button>
    </div>
         <div *ngIf="successMsg.select" class="success-msg">{{ successMsg.select }}</div>
     <div *ngIf="errorMsg.select" class="error-msg">{{ errorMsg.select }}</div>
   </div>
   </div>
     <div *ngIf="columns.length > 0" class="extract-section">
     <div class="section-header">
       <h4>
         <i class="fas fa-search"></i> Extraction de donn√©es
         <button type="button" class="btn btn-sm btn-outline-info" (click)="toggleSection('extract')">
           <i class="fas fa-eye" *ngIf="!showSections.extract"></i>
           <i class="fas fa-eye-slash" *ngIf="showSections.extract"></i>
           {{ showSections.extract ? 'Masquer' : 'Afficher' }}
         </button>
       </h4>
       <p class="section-description">Extrayez des informations sp√©cifiques d'une colonne pour cr√©er une nouvelle colonne</p>
     </div>
     
     <div *ngIf="showSections.extract" class="section-content">
    
          <div class="extract-controls">
        <!-- Ligne principale avec les 3 champs principaux -->
        <div class="extract-main-row">
          <!-- S√©lection de la colonne source -->
          <div class="extract-group">
            <label class="extract-label">
              <i class="fas fa-columns"></i>
              Colonne source :
            </label>
            <mat-form-field appearance="outline" class="extract-select">
              <mat-label>S√©lectionner une colonne</mat-label>
              <mat-select [(ngModel)]="extractCol">
                <mat-option *ngFor="let col of columns" [value]="col">
                  {{ col }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <!-- Type d'extraction -->
          <div class="extract-group">
            <label class="extract-label">
              <i class="fas fa-cut"></i>
              Type d'extraction :
            </label>
            <mat-form-field appearance="outline" class="extract-select">
              <mat-label>Choisir le type d'extraction</mat-label>
              <mat-select [(ngModel)]="extractType">
                <mat-option value="emailDomain">
                  <span class="option-content">
                    <i class="fas fa-envelope"></i>
                    <span>Domaine email</span>
                    <small>Extrait le domaine d'une adresse email</small>
                  </span>
                </mat-option>
                <mat-option value="firstChars">
                  <span class="option-content">
                    <i class="fas fa-align-left"></i>
                    <span>Gauche (n caract√®res)</span>
                    <small>Extrait les n premiers caract√®res</small>
                  </span>
                </mat-option>
                <mat-option value="lastChars">
                  <span class="option-content">
                    <i class="fas fa-align-right"></i>
                    <span>Droite (n caract√®res)</span>
                    <small>Extrait les n derniers caract√®res</small>
                  </span>
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <!-- Nom de la nouvelle colonne -->
          <div class="extract-group">
            <label class="extract-label">
              <i class="fas fa-tag"></i>
              Nom de la nouvelle colonne :
            </label>
            <mat-form-field appearance="outline" class="extract-input">
              <mat-label>Ex: Domaine, Code, etc.</mat-label>
              <input matInput [(ngModel)]="extractKey" placeholder="Nom de la colonne">
              <mat-hint>Nom de la colonne qui contiendra les donn√©es extraites</mat-hint>
            </mat-form-field>
          </div>
        </div>

              <!-- Param√®tres sp√©cifiques pour les caract√®res -->
        <div *ngIf="extractType === 'firstChars' || extractType === 'lastChars'" class="extract-params">
          <div class="extract-params-row">
            <div class="extract-group">
              <label class="extract-label">
                <i class="fas fa-map-marker-alt"></i>
                Position de d√©part :
              </label>
              <mat-form-field appearance="outline" class="extract-number">
                <mat-label>Position</mat-label>
                <input matInput type="number" [(ngModel)]="extractStart" min="1" placeholder="1">
                <mat-hint>Position de d√©part (1 = d√©but)</mat-hint>
              </mat-form-field>
            </div>

            <div class="extract-group">
              <label class="extract-label">
                <i class="fas fa-hashtag"></i>
                Nombre de caract√®res :
              </label>
              <mat-form-field appearance="outline" class="extract-number">
                <mat-label>Nombre</mat-label>
                <input matInput type="number" [(ngModel)]="extractCount" min="1" placeholder="5">
                <mat-hint>Nombre de caract√®res √† extraire</mat-hint>
              </mat-form-field>
            </div>
          </div>
        </div>

      <!-- Aper√ßu de l'extraction -->
      <div *ngIf="extractCol && extractType && extractKey" class="extract-preview">
        <div class="preview-header">
          <i class="fas fa-eye"></i>
          <span>Aper√ßu de l'extraction</span>
        </div>
        <div class="preview-content">
          <p><strong>Source :</strong> {{ extractCol }}</p>
          <p><strong>Type :</strong> 
            <span *ngIf="extractType === 'emailDomain'">Domaine email</span>
            <span *ngIf="extractType === 'firstChars'">Gauche ({{ extractCount }} caract√®res)</span>
            <span *ngIf="extractType === 'lastChars'">Droite ({{ extractCount }} caract√®res)</span>
          </p>
          <p><strong>Nouvelle colonne :</strong> {{ extractKey }}</p>
          <p *ngIf="extractType === 'firstChars' || extractType === 'lastChars'">
            <strong>Param√®tres :</strong> Position {{ extractStart }}, {{ extractCount }} caract√®res
          </p>
        </div>
      </div>

      <!-- Bouton d'extraction -->
      <div class="extract-actions">
        <button mat-raised-button 
                color="primary" 
                (click)="applyExtraction()" 
                [disabled]="!extractCol || !extractType || !extractKey || (extractType !== 'emailDomain' && !extractCount)"
                class="extract-btn">
          <i class="fas fa-magic"></i>
          Extraire les donn√©es
        </button>
        
        <button mat-stroked-button 
                (click)="resetExtraction()" 
                class="reset-btn">
          <i class="fas fa-undo"></i>
          R√©initialiser
        </button>
      </div>
    </div>

    <!-- Messages de succ√®s et d'erreur -->
         <div *ngIf="successMsg.extract" class="success-msg extract-success">
       <i class="fas fa-check-circle"></i>
       {{ successMsg.extract }}
     </div>
     <div *ngIf="errorMsg.extract" class="error-msg extract-error">
       <i class="fas fa-exclamation-triangle"></i>
       {{ errorMsg.extract }}
     </div>
   </div>
   </div>
     <div *ngIf="columns.length > 0 && combinedRows.length > 0" class="filtre-section" style="margin-bottom: 24px;">
     <div class="section-header">
       <h4>
         <i class="fas fa-filter"></i> Filtrer les lignes
         <button type="button" class="btn btn-sm btn-outline-info" (click)="toggleSection('filter')">
           <i class="fas fa-eye" *ngIf="!showSections.filter"></i>
           <i class="fas fa-eye-slash" *ngIf="showSections.filter"></i>
           {{ showSections.filter ? 'Masquer' : 'Afficher' }}
         </button>
       </h4>
     </div>
     
     <div *ngIf="showSections.filter" class="section-content">
    <!-- Filtres multiples -->
    <div class="multiple-filters-container">
      <div class="filters-header">
        <h5>Filtres multiples</h5>
        <button type="button" class="btn btn-sm btn-success" (click)="addNewFilter()">
          <i class="fas fa-plus"></i> Ajouter un filtre
        </button>
      </div>

      <!-- Liste des filtres existants -->
      <div class="filter-list" *ngIf="multipleFilters.length > 0">
        <div class="filter-item" *ngFor="let filter of multipleFilters; trackBy: trackByFilterId">
          <div class="filter-header">
            <div class="filter-title">
              <i class="fas fa-filter"></i>
              Filtre {{ filter.id.replace('filter_', '') }}
            </div>
            <div class="filter-controls">
              <label class="filter-toggle">
                <input type="checkbox" [(ngModel)]="filter.enabled">
                Actif
              </label>
              <button type="button" class="btn btn-sm btn-danger" (click)="removeFilter(filter.id)">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>

          <div class="filter-content" *ngIf="filter.enabled">
            <div class="filter-group">
              <label>Colonne :</label>
              <select [(ngModel)]="filter.column" (change)="onMultipleFilterColumnChange(filter)">
                <option value="">-- Choisir une colonne --</option>
                <option *ngFor="let col of allColumns" [value]="col">{{ col }}</option>
              </select>
            </div>

            <div class="filter-group" *ngIf="filter.column">
              <label>Valeurs √† garder :</label>
              <mat-form-field appearance="fill" class="filter-select">
                <mat-label>S√©lectionner des valeurs</mat-label>
                <mat-select [(ngModel)]="filter.selectedValues" multiple>
                  <mat-option value="__TOUS__" (click)="selectAllMultipleFilterValues(filter)">
                    <strong>üìã Tous</strong>
                  </mat-option>
                  <mat-option *ngFor="let val of filter.filteredFilterValues" [value]="val">
                    {{ val || '(vide)' }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>

      <!-- Actions globales -->
      <div class="filter-actions" *ngIf="multipleFilters.length > 0">
        <button (click)="applyMultipleFilters()" class="apply-btn">
          <i class="fas fa-check"></i> Appliquer tous les filtres
        </button>
        <button (click)="resetAllFilters()" class="reset-btn">
          <i class="fas fa-undo"></i> R√©initialiser tous les filtres
        </button>
      </div>

      <!-- Message d'information -->
      <div class="filter-info" *ngIf="multipleFilters.length === 0">
        <div class="info-box">
          <i class="fas fa-info-circle"></i>
          <p>Aucun filtre configur√©. Cliquez sur "Ajouter un filtre" pour commencer.</p>
        </div>
      </div>
    </div>

    <!-- Ancien syst√®me de filtre unique (maintenu pour compatibilit√©) -->
    <div class="legacy-filter" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
      <h6>Filtre unique (ancien syst√®me)</h6>
    <div class="filter-controls">
      <div class="filter-group">
        <label>Colonne :</label>
        <select [(ngModel)]="selectedFilterColumn" (change)="onFilterColumnChange()">
          <option value="">-- Choisir une colonne --</option>
          <option *ngFor="let col of allColumns" [value]="col">{{ col }}</option>
        </select>
      </div>
      <div class="filter-group" *ngIf="selectedFilterColumn">
        <label>Valeur √† garder :</label>
        <mat-form-field appearance="fill" class="filter-select">
          <mat-label>S√©lectionner des valeurs</mat-label>
          <mat-select #filterValueSelect [(ngModel)]="selectedFilterValues" multiple>
            <mat-option>
              <ngx-mat-select-search [formControl]="filterValueSearchCtrl" placeholderLabel="Rechercher une valeur..." noEntriesFoundLabel="Aucune valeur trouv√©e"></ngx-mat-select-search>
            </mat-option>
            <mat-option value="__TOUS__" (click)="selectAllFilterValues()">
              <strong>üìã Tous</strong>
            </mat-option>
            <mat-option *ngFor="let val of filteredFilterValues" [value]="val">
              {{ val || '(vide)' }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="filter-actions">
        <button (click)="applyFilter()" [disabled]="!selectedFilterColumn || !selectedFilterValues.length" class="apply-btn">Appliquer le filtre</button>
        <button (click)="resetFilter()" [disabled]="!selectedFilterColumn && !selectedFilterValues.length" class="reset-btn">R√©initialiser</button>
      </div>
    </div>
    </div>

         <div *ngIf="successMsg.filter" class="success-msg">{{ successMsg.filter }}</div>
     <div *ngIf="errorMsg.filter" class="error-msg">{{ errorMsg.filter }}</div>
   </div>
   </div>
     <div *ngIf="columns.length > 1" class="concat-section" style="margin-bottom: 24px;">
     <div class="section-header">
       <h4>
         <i class="fas fa-link"></i> Concat√©ner plusieurs colonnes
         <button type="button" class="btn btn-sm btn-outline-info" (click)="toggleSection('concat')">
           <i class="fas fa-eye" *ngIf="!showSections.concat"></i>
           <i class="fas fa-eye-slash" *ngIf="showSections.concat"></i>
           {{ showSections.concat ? 'Masquer' : 'Afficher' }}
         </button>
       </h4>
     </div>
     
     <div *ngIf="showSections.concat" class="section-content">
    <div class="filter-controls">
      <div class="filter-group">
        <label>Colonnes √† concat√©ner :</label>
                 <div class="concat-controls">
           <button type="button" (click)="toggleConcatOrderMode()" class="order-mode-btn" [class.active]="concatOrderMode">
             ‚Üï {{ concatOrderMode ? 'Mode ordre activ√©' : 'Activer mode ordre' }}
           </button>
         </div>
        
        <!-- Mode s√©lection simple -->
        <div *ngIf="!concatOrderMode">
          <mat-form-field appearance="fill" class="filter-select">
            <mat-label>S√©lectionner des colonnes</mat-label>
            <mat-select [(ngModel)]="concatCols" multiple>
              <mat-option *ngFor="let col of columns" [value]="col">
                {{ col }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Mode ordre personnalis√© -->
        <div *ngIf="concatOrderMode" class="concat-order-mode">
          <div class="available-columns">
            <label>Colonnes disponibles :</label>
                         <div class="column-list">
               <div *ngFor="let col of getAvailableColumnsForConcat()" class="column-item" (click)="addConcatColumn(col)">
                 + {{ col }}
               </div>
             </div>
          </div>
          
                     <div class="selected-columns">
             <label>Ordre de concat√©nation :</label>
             <div class="column-list">
               <div *ngFor="let col of concatCols; let i = index" class="column-item selected">
                 <div class="column-controls">
                   <button type="button" (click)="moveConcatColumnUp(i)" [disabled]="i === 0" class="move-btn up" title="D√©placer vers le haut">
                     ‚Üë
                   </button>
                   <button type="button" (click)="moveConcatColumnDown(i)" [disabled]="i === concatCols.length - 1" class="move-btn down" title="D√©placer vers le bas">
                     ‚Üì
                   </button>
                   <button type="button" (click)="removeConcatColumn(i)" class="remove-btn" title="Supprimer">
                     ‚úï
                   </button>
                 </div>
                 <span class="column-name">{{ col }}</span>
                 <div class="column-order-dropdown">
                   <select [value]="i + 1" (change)="onConcatColumnOrderChange($event, i)" class="order-select">
                     <option *ngFor="let pos of getConcatColumnOrderOptions()" [value]="pos">
                       Position {{ pos }}
                     </option>
                   </select>
                 </div>
               </div>
             </div>
           </div>
        </div>
      </div>
      <div class="filter-group">
        <label>Nom de la nouvelle colonne :</label>
        <input type="text" [(ngModel)]="concatNewCol" placeholder="Nom de la colonne" class="filter-input">
      </div>
      <div class="filter-group">
        <label>S√©parateur :</label>
        <input type="text" [(ngModel)]="concatSeparator" placeholder="ex: espace, -, /" class="filter-input">
      </div>
      <div class="filter-actions">
        <button (click)="applyConcat()" [disabled]="!concatCols.length || !concatNewCol" class="apply-btn">Concat√©ner</button>
      </div>
    </div>
         <div *ngIf="successMsg.concat" class="success-msg">{{ successMsg.concat }}</div>
     <div *ngIf="errorMsg.concat" class="error-msg">{{ errorMsg.concat }}</div>
   </div>
   </div>
  <!-- Messages de performance -->
  <div *ngIf="successMsg.performance" class="success-msg performance-msg">
    <span class="performance-icon">‚ö°</span>
    {{ successMsg.performance }}
  </div>
  
     <div *ngIf="columns.length > 0 && combinedRows.length > 0" class="export-by-type-section">
     <div class="section-header">
       <h4>
         <i class="fas fa-file-export"></i> Export par type
         <button type="button" class="btn btn-sm btn-outline-info" (click)="toggleSection('exportByType')">
           <i class="fas fa-eye" *ngIf="!showSections.exportByType"></i>
           <i class="fas fa-eye-slash" *ngIf="showSections.exportByType"></i>
           {{ showSections.exportByType ? 'Masquer' : 'Afficher' }}
         </button>
       </h4>
     </div>
     
     <div *ngIf="showSections.exportByType" class="section-content">
    <div class="filter-controls">
      <div class="filter-group">
        <label>Colonne de tri :</label>
        <mat-form-field appearance="fill" class="filter-select">
          <mat-label>S√©lectionner une colonne</mat-label>
          <mat-select [(ngModel)]="exportTypeCol" (selectionChange)="onExportTypeColChange()">
            <mat-option *ngFor="let col of columns" [value]="col">
              {{ col }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="filter-group" *ngIf="exportTypeCol && exportTypeValues.length > 0">
        <label>Valeurs √† exporter :</label>
        <div class="export-type-values">
          <div class="export-type-controls">
            <button type="button" (click)="selectAllExportTypes()" class="select-all-btn">Tout s√©lectionner</button>
            <button type="button" (click)="deselectAllExportTypes()" class="deselect-all-btn">Tout d√©s√©lectionner</button>
          </div>
          <div class="checkbox-group">
            <label *ngFor="let val of exportTypeValues" class="checkbox-item">
              <input type="checkbox" [value]="val" [checked]="exportTypeSelected.includes(val)" (change)="onExportTypeValueChange($event)">
              {{ val || '(vide)' }}
            </label>
          </div>
        </div>
      </div>
      <div class="filter-group">
        <label>Suffixe du fichier :</label>
        <select [(ngModel)]="exportTypeSuffix" class="filter-input" (change)="onExportTypeSuffixChange()">
          <option value="">(aucun)</option>
          <option value="BO">BO</option>
          <option value="PART">PART</option>
          <option value="CUSTOM">Personnalis√©</option>
        </select>
        <input *ngIf="exportTypeSuffix === 'CUSTOM'" 
               type="text" 
               [(ngModel)]="exportTypeCustomSuffix" 
               placeholder="Entrez votre suffixe personnalis√©" 
               class="filter-input" 
               style="margin-top: 8px;">
      </div>
      <div class="filter-group">
        <label>Description :</label>
        <input type="text" [(ngModel)]="exportTypeDescription" placeholder="Description" class="filter-input">
      </div>
      <div class="filter-group">
        <label>Format de fichier :</label>
        <div class="format-options">
          <label class="format-option">
            <input type="radio" [(ngModel)]="exportTypeFormat" value="csv" name="exportTypeFormat">
            <span>CSV</span>
          </label>
          <label class="format-option">
            <input type="radio" [(ngModel)]="exportTypeFormat" value="xls" name="exportTypeFormat">
            <span>XLS</span>
          </label>
          <label class="format-option">
            <input type="radio" [(ngModel)]="exportTypeFormat" value="xlsx" name="exportTypeFormat">
            <span>XLSX</span>
          </label>
        </div>
      </div>
      <div class="filter-actions">
        <button type="button" (click)="exportByType()" [disabled]="!exportTypeCol || exportTypeSelected.length === 0" class="apply-btn">Exporter par type</button>
      </div>
    </div>
         <div *ngIf="successMsg.exportType" class="success-msg">{{ successMsg.exportType }}</div>
     <div *ngIf="errorMsg.exportType" class="error-msg">{{ errorMsg.exportType }}</div>
   </div>
   </div>
     <div *ngIf="columns.length > 0" class="dedup-section">
     <div class="section-header">
       <h4>
         <i class="fas fa-copy"></i> Suppression de doublons
         <button type="button" class="btn btn-sm btn-outline-info" (click)="toggleSection('dedup')">
           <i class="fas fa-eye" *ngIf="!showSections.dedup"></i>
           <i class="fas fa-eye-slash" *ngIf="showSections.dedup"></i>
           {{ showSections.dedup ? 'Masquer' : 'Afficher' }}
         </button>
       </h4>
     </div>
     
     <div *ngIf="showSections.dedup" class="section-content">
    <label>S√©lectionnez les colonnes √† utiliser :</label>
    <div class="dedup-cols">
      <label *ngFor="let col of columns">
        <input type="checkbox" [value]="col" (change)="onDedupColChange($event)">
        {{ col }}
      </label>
    </div>
         <button type="button" (click)="deduplicate()" [disabled]="dedupCols.length === 0">Supprimer les doublons</button>
     <div *ngIf="successMsg.dedup" class="success-msg">{{ successMsg.dedup }}</div>
     <div *ngIf="errorMsg.dedup" class="error-msg">{{ errorMsg.dedup }}</div>
   </div>
   </div>
     <div *ngIf="columns.length > 0 && combinedRows.length > 0" class="export-by-date-section">
     <div class="section-header">
       <h4>
         <i class="fas fa-calendar-alt"></i> Export par date
         <button type="button" class="btn btn-sm btn-outline-info" (click)="toggleSection('exportByDate')">
           <i class="fas fa-eye" *ngIf="!showSections.exportByDate"></i>
           <i class="fas fa-eye-slash" *ngIf="showSections.exportByDate"></i>
           {{ showSections.exportByDate ? 'Masquer' : 'Afficher' }}
         </button>
       </h4>
     </div>
     
     <div *ngIf="showSections.exportByDate" class="section-content">
    <div class="export-date-controls">
      <div class="filter-group">
        <label>Colonne de date :</label>
        <mat-form-field appearance="fill" class="filter-select">
          <mat-label>S√©lectionner une colonne de date</mat-label>
          <mat-select [(ngModel)]="exportDateCol" (selectionChange)="onExportDateColChange()">
            <mat-option *ngFor="let col of columns" [value]="col">
              {{ col }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      
      <div class="filter-group" *ngIf="exportDateCol">
        <label>P√©riode d'export :</label>
        <div class="date-period-options">
          <div class="period-option">
            <label class="period-label">
              <input type="radio" [(ngModel)]="exportDatePeriod" (change)="onExportPeriodChange()" value="day" name="exportDatePeriod">
              <span class="period-text">
                <i class="fas fa-calendar-day"></i>
                <strong>Par jour</strong>
                <small>Export s√©par√© pour chaque jour</small>
              </span>
            </label>
          </div>
          <div class="period-option">
            <label class="period-label">
              <input type="radio" [(ngModel)]="exportDatePeriod" (change)="onExportPeriodChange()" value="week" name="exportDatePeriod">
              <span class="period-text">
                <i class="fas fa-calendar-week"></i>
                <strong>Par semaine</strong>
                <small>Export s√©par√© pour chaque semaine</small>
              </span>
            </label>
          </div>
          <div class="period-option">
            <label class="period-label">
              <input type="radio" [(ngModel)]="exportDatePeriod" (change)="onExportPeriodChange()" value="month" name="exportDatePeriod">
              <span class="period-text">
                <i class="fas fa-calendar"></i>
                <strong>Par mois</strong>
                <small>Export s√©par√© pour chaque mois</small>
              </span>
            </label>
          </div>
          <div class="period-option">
            <label class="period-label">
              <input type="radio" [(ngModel)]="exportDatePeriod" (change)="onExportPeriodChange()" value="hour" name="exportDatePeriod">
              <span class="period-text">
                <i class="fas fa-clock"></i>
                <strong>Par heure</strong>
                <small>Export s√©par√© pour chaque heure</small>
              </span>
            </label>
          </div>
          <div class="period-option">
            <label class="period-label">
              <input type="radio" [(ngModel)]="exportDatePeriod" (change)="onExportPeriodChange()" value="timerange" name="exportDatePeriod">
              <span class="period-text">
                <i class="fas fa-hourglass-half"></i>
                <strong>Par plage horaire</strong>
                <small>Export par tranches de N minutes</small>
              </span>
            </label>
          </div>
        </div>
      </div>
      
      <!-- Param√®tre de plage horaire -->
      <div class="filter-group" *ngIf="exportDateCol && exportDatePeriod === 'timerange'">
        <label>Dur√©e de la plage (minutes) :</label>
        <input type="number" min="1" step="1" [(ngModel)]="exportTimeRangeMinutes" (ngModelChange)="onExportTimeRangeMinutesChange()" class="filter-input" placeholder="60">
        <small class="help-text">Les enregistrements seront regroup√©s par tranches de {{ exportTimeRangeMinutes }} minute(s).</small>
      </div>

      <div class="filter-group" *ngIf="exportDateCol && exportDatePeriod">
        <label>Format de fichier :</label>
        <div class="format-options">
          <label class="format-option">
            <input type="radio" [(ngModel)]="exportDateFormat" value="csv" name="exportDateFormat">
            <span>CSV</span>
          </label>
          <label class="format-option">
            <input type="radio" [(ngModel)]="exportDateFormat" value="xls" name="exportDateFormat">
            <span>XLS</span>
          </label>
          <label class="format-option">
            <input type="radio" [(ngModel)]="exportDateFormat" value="xlsx" name="exportDateFormat">
            <span>XLSX</span>
          </label>
        </div>
      </div>
      
      <div class="filter-group" *ngIf="exportDateCol && exportDatePeriod">
        <label>Pr√©fixe des fichiers :</label>
        <input type="text" [(ngModel)]="exportDatePrefix" placeholder="export" class="filter-input">
        <small class="help-text">Le nom des fichiers sera : [pr√©fixe]_[p√©riode]_[date].csv/xls/xlsx</small>
      </div>
      
      <!-- Message d'information sur l'export de la page courante -->
      <div *ngIf="exportDateCol && exportDatePeriod && detectedPeriods.length > 0" class="export-complete-info">
        <div class="info-box">
          <i class="fas fa-info-circle"></i>
          <div class="info-content">
            <strong>Export de la page courante :</strong> Seuls les {{ getPagedDetectedPeriods().length }} fichiers de la page {{ detectedPeriodsPage }} seront export√©s.
            <br><small>Pour exporter toutes les {{ detectedPeriods.length }} p√©riodes, naviguez entre les pages et exportez chaque page.</small>
            <br><small><strong>Debug :</strong> Ouvrez la console du navigateur (F12) pour voir les d√©tails de d√©tection des dates.</small>
          </div>
        </div>
      </div>
      
      <div class="filter-actions">
        <button type="button" (click)="exportByDate()" 
                [disabled]="!exportDateCol || !exportDatePeriod || !exportDateFormat" 
                class="apply-btn">
          <i class="fas fa-download"></i> Exporter page courante ({{ getPagedDetectedPeriods().length }} fichiers)
        </button>
        <button type="button" (click)="exportAllPages()" 
                [disabled]="!exportDateCol || !exportDatePeriod || !exportDateFormat" 
                class="btn btn-outline-primary">
          <i class="fas fa-download"></i> Exporter toutes les pages ({{ detectedPeriods.length }} fichiers)
        </button>
        <button type="button" (click)="forceRedetectPeriods()" 
                [disabled]="!exportDateCol || !exportDatePeriod" 
                class="btn btn-outline-info">
          <i class="fas fa-search"></i> Re-d√©tecter les p√©riodes
        </button>
        <button type="button" (click)="resetExportDate()" class="reset-btn">
          <i class="fas fa-undo"></i> R√©initialiser
        </button>
      </div>
    </div>
    
    <!-- Aper√ßu des p√©riodes d√©tect√©es avec pagination -->
    <div *ngIf="exportDateCol && exportDatePeriod && detectedPeriods.length > 0" class="detected-periods">
      <div class="periods-header">
        <h5><i class="fas fa-list"></i> P√©riodes d√©tect√©es ({{ detectedPeriods.length }})</h5>
        <div class="periods-per-page" *ngIf="detectedPeriods.length > 5">
          <label>Afficher par :</label>
          <select [(ngModel)]="detectedPeriodsPageSize" (ngModelChange)="onPeriodsPageSizeChange()" class="form-control form-control-sm">
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
          </select>
        </div>
      </div>
      <div class="periods-list">
        <div *ngFor="let period of getPagedDetectedPeriods()" class="period-item">
          <span class="period-label">{{ period.label }}</span>
          <span class="period-count">{{ period.count }} lignes</span>
        </div>
      </div>
      
      <!-- Contr√¥les de pagination -->
      <div *ngIf="detectedPeriodsTotalPages > 1" class="periods-pagination">
        <div class="pagination-info">
          Page {{ detectedPeriodsPage }} sur {{ detectedPeriodsTotalPages }}
          ({{ detectedPeriods.length }} p√©riodes au total)
        </div>
        <div class="export-note">
          <i class="fas fa-download"></i>
          <strong>Export de la page courante :</strong> L'export cr√©era <strong>{{ getPagedDetectedPeriods().length }} fichiers</strong> pour la page {{ detectedPeriodsPage }} seulement.
        </div>
        <div class="pagination-controls">
          <button type="button" 
                  (click)="previousDetectedPeriodsPage()" 
                  [disabled]="detectedPeriodsPage === 1"
                  class="btn btn-sm btn-outline-secondary">
            <i class="fas fa-chevron-left"></i> Pr√©c√©dent
          </button>
          
          <div class="page-numbers">
            <button *ngFor="let page of [].constructor(detectedPeriodsTotalPages); let i = index" 
                    type="button"
                    (click)="goToDetectedPeriodsPage(i + 1)"
                    [class.active]="detectedPeriodsPage === (i + 1)"
                    class="btn btn-sm btn-outline-secondary page-number">
              {{ i + 1 }}
            </button>
          </div>
          
          <button type="button" 
                  (click)="nextDetectedPeriodsPage()" 
                  [disabled]="detectedPeriodsPage === detectedPeriodsTotalPages"
                  class="btn btn-sm btn-outline-secondary">
            Suivant <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
    
    <div *ngIf="successMsg.exportDate" class="success-msg">{{ successMsg.exportDate }}</div>
    <div *ngIf="errorMsg.exportDate" class="error-msg">{{ errorMsg.exportDate }}</div>
   </div>
   </div>

     <div *ngIf="columns.length > 0" class="format-section">
     <div class="section-header">
       <h4>
         <i class="fas fa-magic"></i> Formatage automatique
         <button type="button" class="btn btn-sm btn-outline-info" (click)="toggleSection('format')">
           <i class="fas fa-eye" *ngIf="!showSections.format"></i>
           <i class="fas fa-eye-slash" *ngIf="showSections.format"></i>
           {{ showSections.format ? 'Masquer' : 'Afficher' }}
         </button>
       </h4>
     </div>
     
     <div *ngIf="showSections.format" class="section-content">
    <div class="format-options">
      <!-- Option : Supprimer des caract√®res -->
      <label>
        <input type="checkbox" [(ngModel)]="formatOptions['removeCharacters']"> Supprimer des caract√®res
      </label>
      <div *ngIf="formatOptions['removeCharacters']" class="format-columns">
        <label>Colonnes √† traiter :</label>
        <select multiple [(ngModel)]="formatSelections['removeCharacters']">
          <option *ngFor="let col of columns" [value]="col">{{ col }}</option>
        </select>
        <div class="remove-char-options">
          <div class="option-group">
            <label>Position :</label>
            <select [(ngModel)]="removeCharPosition">
              <option value="start">Depuis le d√©but</option>
              <option value="end">Depuis la fin</option>
              <option value="specific">Position sp√©cifique</option>
            </select>
          </div>
          <div class="option-group" *ngIf="removeCharPosition === 'specific'">
            <label>Position (1-based) :</label>
            <input type="number" [(ngModel)]="removeCharSpecificPosition" min="1" style="width: 80px;">
          </div>
          <div class="option-group">
            <label>Nombre de caract√®res :</label>
            <input type="number" [(ngModel)]="removeCharCount" min="1" style="width: 80px;">
          </div>
        </div>
        <button type="button" (click)="applyRemoveCharactersFormatting()" [disabled]="!formatSelections['removeCharacters'].length">Appliquer</button>
      </div>

      <!-- Option : Supprimer caract√®res sp√©ciaux -->
      <label>
        <input type="checkbox" [(ngModel)]="formatOptions['removeSpecialStrings']"> Supprimer caract√®res sp√©ciaux
      </label>
      <div *ngIf="formatOptions['removeSpecialStrings']" class="format-columns">
        <label>Colonnes √† traiter :</label>
        <select multiple [(ngModel)]="formatSelections['removeSpecialStrings']">
          <option *ngFor="let col of columns" [value]="col">{{ col }}</option>
        </select>
        <div class="remove-special-strings-options">
          <div class="option-group">
            <label>Cha√Æne √† supprimer :</label>
            <input type="text" [(ngModel)]="specialStringToRemove" placeholder="Ex: _CM" style="width: 150px;">
          </div>
          <div class="option-group">
            <label>Mode de suppression :</label>
            <select [(ngModel)]="specialStringRemovalMode">
              <option value="all">Toutes les occurrences</option>
              <option value="start">Seulement au d√©but</option>
              <option value="end">Seulement √† la fin</option>
            </select>
          </div>
        </div>
        <div class="remove-special-strings-help">
          <small class="help-text">
            üí° Cette option va supprimer une cha√Æne de caract√®res sp√©cifique des valeurs s√©lectionn√©es.
            <br><strong>Toutes les occurrences :</strong> "ABC_CM_DEF_CM" ‚Üí "ABC_DEF"
            <br><strong>Au d√©but :</strong> "_CM_ABC" ‚Üí "ABC"
            <br><strong>√Ä la fin :</strong> "ABC_CM" ‚Üí "ABC"
          </small>
        </div>
        <button type="button" (click)="applyRemoveSpecialStringsFormatting()" [disabled]="!formatSelections['removeSpecialStrings'].length || !specialStringToRemove">Appliquer</button>
      </div>
      
      <!-- Option : Supprimer des nombres -->
      <label>
        <input type="checkbox" [(ngModel)]="formatOptions['removeNumbers']"> Supprimer des nombres
      </label>
      <div *ngIf="formatOptions['removeNumbers']" class="format-columns">
        <label>Colonnes √† traiter :</label>
        <select multiple [(ngModel)]="formatSelections['removeNumbers']">
          <option *ngFor="let col of columns" [value]="col">{{ col }}</option>
        </select>
        <div class="remove-numbers-help">
               <small class="help-text">
            üí° Cette option va supprimer tous les chiffres (0-9) des valeurs s√©lectionn√©es.
            <br>Exemple : "ABC123DEF456" ‚Üí "ABCDEF"
            <br>Exemple : "T√©l√©phone: 0123456789" ‚Üí "T√©l√©phone: "
               </small>
             </div>
        <button type="button" (click)="applyRemoveNumbersFormatting()" [disabled]="!formatSelections['removeNumbers'].length">Appliquer</button>
      </div>
      
      <!-- Option : Supprimer indicatif -->
      <label>
        <input type="checkbox" [(ngModel)]="formatOptions['removeIndicatif']"> Supprimer indicatif
      </label>
      <div *ngIf="formatOptions['removeIndicatif']" class="format-columns">
        <label>Colonnes √† traiter :</label>
        <select multiple [(ngModel)]="formatSelections['removeIndicatif']">
          <option *ngFor="let col of columns" [value]="col">{{ col }}</option>
        </select>
        <div class="remove-indicatif-options">
          <div class="option-group">
            <label>Type d'indicatif :</label>
            <select [(ngModel)]="indicatifType">
              <option value="international">International (+XX)</option>
              <option value="national">National fran√ßais (0X)</option>
              <option value="custom">Personnalis√©</option>
            </select>
          </div>
          <div class="option-group" *ngIf="indicatifType === 'custom'">
            <label>Indicatif personnalis√© :</label>
            <input type="text" [(ngModel)]="customIndicatif" placeholder="+33" style="width: 100px;">
          </div>
          </div>
        <div class="remove-indicatif-help">
          <small class="help-text">
            üí° Cette option va supprimer les indicatifs t√©l√©phoniques selon le type choisi.
            <br><strong>International :</strong> "+33 1 23 45 67 89" ‚Üí "1 23 45 67 89"
            <br><strong>National fran√ßais :</strong> "01 23 45 67 89" ‚Üí "1 23 45 67 89"
            <br><strong>Personnalis√© :</strong> Supprime l'indicatif sp√©cifi√©
          </small>
        </div>
                <button type="button" (click)="applyRemoveIndicatifFormatting()" [disabled]="!formatSelections['removeIndicatif'].length">Appliquer</button>
      </div>

      <!-- Option : Supprimer d√©cimales -->
      <label>
        <input type="checkbox" [(ngModel)]="formatOptions['removeDecimals']"> Supprimer d√©cimales
      </label>
      <div *ngIf="formatOptions['removeDecimals']" class="format-columns">
        <label>Colonnes √† traiter :</label>
        <select multiple [(ngModel)]="formatSelections['removeDecimals']">
          <option *ngFor="let col of columns" [value]="col">{{ col }}</option>
        </select>
        <div class="remove-decimals-options">
          <div class="option-group">
            <label>S√©parateur d√©cimal :</label>
            <select [(ngModel)]="decimalSeparator">
              <option value=",">Virgule (3000,00)</option>
              <option value=".">Point (3000.00)</option>
            </select>
          </div>
          <div class="option-group">
            <label>
              <input type="checkbox" [(ngModel)]="keepTrailingZeros"> Garder les valeurs non nulles
            </label>
            <small class="help-text">Si activ√©, ne supprime que les d√©cimales qui sont des z√©ros</small>
          </div>
        </div>
        <div class="remove-decimals-help">
          <small class="help-text">
            üí° Cette option va supprimer la partie d√©cimale des montants.
            <br><strong>Avec virgule :</strong> "3000,00" ‚Üí "3000" | "1500,50" ‚Üí "1500" (si garder valeurs non nulles = false)
            <br><strong>Avec point :</strong> "3000.00" ‚Üí "3000" | "1500.50" ‚Üí "1500" (si garder valeurs non nulles = false)
            <br><strong>Option "Garder valeurs non nulles" :</strong> "1500,50" reste "1500,50" | "3000,00" ‚Üí "3000"
          </small>
        </div>
        <button type="button" (click)="applyRemoveDecimalsFormatting()" [disabled]="!formatSelections['removeDecimals'].length">Appliquer</button>
      </div>

      <!-- Option : Garder N derniers digits -->
      <label>
        <input type="checkbox" [(ngModel)]="formatOptions['keepLastDigits']"> Garder N derniers digits
      </label>
      <div *ngIf="formatOptions['keepLastDigits']" class="format-columns">
        <label>Colonnes √† traiter :</label>
        <select multiple [(ngModel)]="formatSelections['keepLastDigits']">
          <option *ngFor="let col of columns" [value]="col">{{ col }}</option>
        </select>
        <div class="keep-digits-options">
          <div class="option-group">
            <label>Nombre de digits √† garder :</label>
            <input type="number" [(ngModel)]="keepLastDigitsCount" min="1" max="20" placeholder="3">
          </div>
          <small class="help-text">
            <strong>Exemple :</strong> "774478320" avec 3 digits ‚Üí "320"
            <br><strong>Autres exemples :</strong> "1234567890" avec 4 digits ‚Üí "7890"
            <br><strong>Note :</strong> Seuls les chiffres sont extraits, les autres caract√®res sont ignor√©s
          </small>
        </div>
        <button type="button" (click)="applyKeepLastDigitsFormatting()" [disabled]="!formatSelections['keepLastDigits'].length || keepLastDigitsCount <= 0">Appliquer</button>
      </div>

      <!-- Option : Supprimer .0 sur les dates -->
      <label>
        <input type="checkbox" [(ngModel)]="formatOptions['removeZeroDecimals']"> Supprimer .0 sur les dates
      </label>
      <div *ngIf="formatOptions['removeZeroDecimals']" class="format-columns">
        <label>Colonnes √† traiter :</label>
        <select multiple [(ngModel)]="formatSelections['removeZeroDecimals']">
          <option *ngFor="let col of columns" [value]="col">{{ col }}</option>
        </select>
        <div class="remove-zero-decimals-help">
          <small class="help-text">
            üí° Cette option va supprimer les d√©cimales .0 des valeurs num√©riques qui repr√©sentent des dates.
            <br><strong>Exemple :</strong> "2024-01-15.0" ‚Üí "2024-01-15"
            <br><strong>Autres exemples :</strong> "2023-12-25.0" ‚Üí "2023-12-25"
            <br><strong>Note :</strong> Seules les d√©cimales .0 sont supprim√©es, les autres d√©cimales sont conserv√©es
          </small>
        </div>
        <button type="button" (click)="applyRemoveZeroDecimalsFormatting()" [disabled]="!formatSelections['removeZeroDecimals'].length">Appliquer</button>
      </div>

      <!-- Option : Supprimer les espaces -->
      <label>
        <input type="checkbox" [(ngModel)]="formatOptions['removeSpaces']"> Supprimer les espaces
      </label>
      <div *ngIf="formatOptions['removeSpaces']" class="format-columns">
        <label>Colonnes √† traiter :</label>
        <select multiple [(ngModel)]="formatSelections['removeSpaces']">
          <option *ngFor="let col of columns" [value]="col">{{ col }}</option>
        </select>
        <div class="remove-spaces-options">
          <div class="option-group">
            <label>Type de suppression :</label>
            <select [(ngModel)]="removeSpacesType">
              <option value="all">Tous les espaces</option>
              <option value="leading">Espaces en d√©but</option>
              <option value="trailing">Espaces en fin</option>
              <option value="multiple">Espaces multiples</option>
            </select>
          </div>
        </div>
        <div class="remove-spaces-help">
          <small class="help-text">
            üí° Cette option va supprimer les espaces selon le type choisi.
            <br><strong>Tous les espaces :</strong> "A B C" ‚Üí "ABC"
            <br><strong>Espaces en d√©but :</strong> "  ABC" ‚Üí "ABC"
            <br><strong>Espaces en fin :</strong> "ABC  " ‚Üí "ABC"
            <br><strong>Espaces multiples :</strong> "A  B   C" ‚Üí "A B C"
          </small>
        </div>
        <button type="button" (click)="applyRemoveSpacesFormatting()" [disabled]="!formatSelections['removeSpaces'].length">Appliquer</button>
      </div>
    </div>
    <div *ngIf="successMsg.format" class="success-msg">{{ successMsg.format }}</div>
    <div *ngIf="errorMsg.format" class="error-msg">{{ errorMsg.format }}</div>
   </div>
   </div>

</div> 